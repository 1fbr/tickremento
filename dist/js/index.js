import{getProducts as e,getSearchResults as a,getSupermarketProducts as r}from"./services/products.js";import{maxPages as t,supermarketPages as n}from"./utils/supermarket-pages.js";import{removeChilds as l,debounce as s,isModalDisplayed as c}from"./utils/event-utils.js";let mainContainer=document.querySelector(".main-container"),search=document.querySelector(".product-filter"),cleanSearch=document.querySelector(".clean-search"),checkboxesWrapper=document.querySelector(".checkboxes-wrapper"),supermarkets=document.querySelectorAll("input[type='checkbox']"),spinner=document.querySelector(".spinner"),actualPage=1,searchTerm="",supermarketName="";document.addEventListener("DOMContentLoaded",()=>{e(actualPage)}),search.addEventListener("input",s(r=>{spinner.style.display="block",l(mainContainer),searchTerm=r.target.value.toLowerCase(),r.target.value.length>=2&&(cleanSearch.disabled=!1,spinner.style.display="none",a(searchTerm)),0===r.target.value.length&&(cleanSearch.disabled=!0,e(actualPage=1))},250)),cleanSearch.addEventListener("click",()=>{spinner.style.display="block",l(mainContainer),cleanSearch.disabled=!0,search.value="",actualPage=1});let handleSupermarketChange=a=>{if(spinner.style.display="block",!c()){a.preventDefault(),l(mainContainer),search.value="",actualPage=1;for(let t=0;t<supermarkets.length;t++){if(supermarkets[t].checked){supermarketName=supermarkets[t].id;break}supermarketName=""}supermarketName?r(supermarketName,actualPage):e(actualPage)}};checkboxesWrapper.addEventListener("change",function(e){let a=e.target;if("checkbox"===a.type){let r=supermarkets;for(let t=0;t<r.length;t++)r[t]!==a&&(r[t].checked=!1);handleSupermarketChange(e)}});let debouncePagination=s(e=>{let{scrollHeight:a,scrollTop:r}=e.target.documentElement;0===search.value.length&&r+window.innerHeight>=a&&setTimeout(newPage,150)},200);window.addEventListener("scroll",debouncePagination);let newPage=()=>{if(c())return;actualPage++;let a=""!==supermarketName?n[supermarketName]:t;if(actualPage>a){spinner.style.display="none";return}""!==supermarketName?r(supermarketName,actualPage):e(actualPage)};